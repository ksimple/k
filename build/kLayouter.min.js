define("kLayouter",["require","exports","kFundamental","jquery"],function(a,b,c,d){function e(){return Math.floor(window.performance.now())+"-"+Math.floor(1e4*Math.random())}function f(a){return a.match(/(\d*)(.*)/).slice(1)}function g(a,b){b?l[a]=b:delete l[a];var c="";for(var a in l)c+=l[a];m.content(c)}function h(a){if(a){var b=new c.CssTextBuilder;b.pushSelector("html, body"),b.property("position","absolute"),b.property("width","100%"),b.property("height","100%"),b.property("border","0px"),b.property("margin",0,"px"),b.property("padding",0,"px"),g("body",b.toString())}else g("body")}function i(a){a=d(a).eq(0),a[0]==window&&(a=d(document.body));var b=a.find("[data-kl-type]");a.attr("data-kl-type")&&(b=d(a).add(b));for(var c=0;c<b.length;c++){var e=b.eq(c);if(!e.data("kl-item"))switch(e.attr("data-kl-type")){case"vertical":e.data("kl-item",new j(e));break;case"horizontal":e.data("kl-item",new k(e))}}}var j=function(){function a(a){this._element=a,this._className="kl-vertical-"+e(),this._element.addClass(this._className),"BODY"==this._element[0].tagName&&h(!0),this.layout()}return a.prototype.layout=function(){for(var a=this._element.find(">div"),b=new c.CssTextBuilder,d=[],e="",h=0;h<a.length;h++){var i=a.eq(h),j=f(i.attr("data-kl-vertical-height")),k=j[0],l=j[1],m={index:h,height:k,unit:l,css:{}};switch(d.push(m),l){case"px":case"%":e+=""==e?m.height+m.unit:" + "+m.height+m.unit;break;case"?":var n=i.height();m.height=n,m.unit="px",e+=""==e?m.height+m.unit:" + "+m.height+m.unit}}for(var o="0px",h=0;h<a.length;h++){var m=d[h];switch(m.css.top="calc("+o+")",m.unit){case"px":case"%":o+=" + "+m.height+m.unit,m.css.height="calc("+m.height+m.unit+")";break;case"%*":o+=" + (100% - ("+e+")) * "+m.height+" / 100",m.css.height="calc((100% - ("+e+")) * "+m.height+" / 100)";break;case"*":o+=" + (100% - ("+e+"))",m.css.height="calc(100% - ("+e+"))"}}b.pushSelector("."+this._className),b.property("position","relative");for(var h=0;h<a.length;h++){var i=a.eq(h),m=d[h];i.addClass(this._className+"-"+h),b.pushSelector("."+this._className+">."+this._className+"-"+h),b.property("height",m.css.height),b.property("top",m.css.top),b.property("width",100,"%"),b.property("position","absolute")}g(this._className,b.toString())},a}(),k=function(){function a(a){this._element=a}return a}(),l={},m=new c.DynamicStylesheet("kLayouter-"+e());b.attach=i});