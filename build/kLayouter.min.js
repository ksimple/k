define("kLayouter",["require","exports","kFundamental","jquery"],function(a,b,c,d){function e(){return window.performance&&window.performance.now?Math.floor(window.performance.now())+"-"+Math.floor(1e4*Math.random()):(new Date).valueOf()+"-"+Math.floor(1e4*Math.random())}function f(a){return a.match(/(\d*)(.*)/).slice(1)}function g(a,b){b?l[a]=b:delete l[a];var c="";for(var a in l)c+=l[a];m.content(c)}function h(){d(document.body).trigger("kLayouter.sizeChanged",{target:document.body})}function i(a){if(a){var b=new c.CssTextBuilder;b.pushSelector("html, body"),b.property("position","absolute"),b.property("width","100%"),b.property("height","100%"),b.property("border","0px"),b.property("margin",0,"px"),b.property("padding",0,"px"),g("body",b.toString()),d(window).on("resize",h)}else g("body"),d(window).off("resize",h)}function j(a){a=d(a).eq(0),a[0]==window&&(a=d(document.body));var b=a.find("[kLayouter-type]");a.attr("kLayouter-type")&&(b=d(a).add(b));for(var c=0;c<b.length;c++){var e=b.eq(c);if(!e[0]["kLayouter-item"])switch(e.attr("kLayouter-type")){case"vertical":e[0]["kLayouter-item"]=new k(e,"vertical");break;case"horizontal":e[0]["kLayouter-item"]=new k(e,"horizontal")}}}var k=function(){function a(a,b){var c=this;this._direction=b,this._element=a,this._className="kLayouter-"+e(),this._element.addClass(this._className),"vertical"==this._direction?(this._offsetName="top",this._offsetName="top",this._lengthName="height",this._quadratureLengthName="width"):(this._offsetName="left",this._lengthName="width",this._quadratureLengthName="height"),"BODY"==this._element[0].tagName&&i(!0),this.layout(),this._element.on("kLayouter.sizeChanged",function(a){return c._sizeChanged(a)}),this._element.on("kLayouter.relayout",function(a){return c._relayout(a)})}return a.prototype.layout=function(){for(var a=this._element.find(">div"),b=new c.CssTextBuilder,d=[],e="",h="",i=0,j=!1,k=0;k<a.length;k++){var l=a.eq(k),m=l.attr("kLayouter-"+this._lengthName),n=f(m),o=n[0],p=n[1],q={raw:m,index:k,length:o,unit:p,css:{}};if(d.push(q),"?"==m){if(!j){var r=new c.CssTextBuilder;r.pushSelector("."+this._className),r.property("position","relative"),r.pushSelector("."+this._className+">*"),r.property("position","absolute"),g(this._className,r.toString()),j=!0}var s;l.css("position","relative"),"vertical"==this._direction?s=l[this._lengthName]():(l.css("display","inline-block"),s=l[this._lengthName](),l.css("display","")),l.css("position",""),q.length=s,q.unit="px",e+=""==e?q.length+q.unit:" + "+q.length+q.unit,h+=""==h?q.length+q.unit:" + "+q.length+q.unit}else("px"==q.unit||"%"==q.unit)&&(e+=""==e?q.length+q.unit:" + "+q.length+q.unit,"%"!=q.unit?h+=""==h?q.length+q.unit:" + "+q.length+q.unit:i+=q.length)}for(var t="0px",k=0;k<a.length;k++){var q=d[k];q.css.offset="calc("+t+")","*"==q.raw?(t+=" + (100% - ("+e+"))",q.css.length="calc(100% - ("+e+"))"):"px"==q.unit||"%"==q.unit?(t+=" + "+q.length+q.unit,q.css.length="calc("+q.length+q.unit+")"):"%*"==q.unit&&(t+=" + (100% - ("+e+")) * "+q.length+" / 100",q.css.length="calc((100% - ("+e+")) * "+q.length+" / 100)")}b.pushSelector("."+this._className),b.property("position","relative"),b.property("min-"+this._lengthName,"calc(("+h+") / "+(100-i)+" * 100)"),b.property("overflow","hidden");for(var k=0;k<a.length;k++){var l=a.eq(k),q=d[k];l.addClass(this._className+"-"+k),b.pushSelector("."+this._className+">."+this._className+"-"+k),"?"!=q.raw&&b.property(this._lengthName,q.css.length),b.property(this._offsetName,q.css.offset),b.property(this._quadratureLengthName,100,"%"),b.property("position","absolute")}g(this._className,b.toString());for(var k=0;k<a.length;k++){var l=a.eq(k);l.trigger("kLayouter.sizeChanged",{target:l[0]})}},a.prototype._sizeChanged=function(a){a.target==this._element[0]&&this.layout()},a.prototype._relayout=function(a){a.target==this._element[0]&&this.layout()},a}(),l={},m=new c.DynamicStylesheet("kLayouter-"+e());b.attach=j});