define("kLayouter",["require","exports","kFundamental","jquery"],function(a,b,c,d){function e(){return window.performance&&window.performance.now?Math.floor(window.performance.now())+"-"+Math.floor(1e4*Math.random()):(new Date).valueOf()+"-"+Math.floor(1e4*Math.random())}function f(a){return a.match(/(\d*)(.*)/).slice(1)}function g(a,b){b?l[a]=b:delete l[a];var c="";for(var a in l)c+=l[a];m.content(c)}function h(){d(document.body).kLayouter("layout")}function i(a){if(a){var b=new c.CssTextBuilder;b.pushSelector("html, body"),b.property("position","absolute"),b.property("width","100%"),b.property("height","100%"),b.property("border","0px"),b.property("margin",0,"px"),b.property("padding",0,"px"),g("body",b.toString()),d(window).on("resize",h)}else g("body"),d(window).off("resize",h)}function j(a){a=d(a).eq(0),a[0]==window&&(a=d(document.body));var b=a.find("[kLayouter-type]");a.attr("kLayouter-type")&&(b=d(a).add(b));for(var c=0;c<b.length;c++){var e=b.eq(c);if(!e[0]["kLayouter-item"])switch(e.attr("kLayouter-type")){case"vertical":e[0]["kLayouter-item"]=new k(e,"vertical");break;case"horizontal":e[0]["kLayouter-item"]=new k(e,"horizontal")}}}var k=function(){function a(a,b){this._direction=b,this._element=a,this._className="kLayouter-"+e(),this._element.addClass(this._className),"vertical"==this._direction?(this._offsetName="top",this._offsetName="top",this._lengthName="height",this._quadratureLengthName="width"):(this._offsetName="left",this._lengthName="width",this._quadratureLengthName="height"),"BODY"==this._element[0].tagName&&i(!0),this.layout(!0)}return a.prototype.layout=function(a){void 0===a&&(a=!1);var b=this._element.width(),d=this._element.height(),e=this._width!=b||this._height!=d;if(a||!e){for(var h=this._element.find(">div"),i=new c.CssTextBuilder,j=[],k="",l="",m=0,n=!1,o=0;o<h.length;o++){var p=h.eq(o),q=p.attr("kLayouter-"+this._lengthName),r=f(q),s=r[0],t=r[1],u={raw:q,index:o,length:s,unit:t,css:{}};if(j.push(u),"?"==q){if(!n){var v=new c.CssTextBuilder;v.pushSelector("."+this._className),v.property("position","relative"),v.pushSelector("."+this._className+">*"),v.property("position","absolute"),g(this._className,v.toString()),n=!0}var w;p.css("position","relative"),"vertical"==this._direction?w=p[this._lengthName]():(p.css("display","inline-block"),w=p[this._lengthName](),p.css("display","")),p.css("position",""),u.length=w,u.unit="px",k+=""==k?u.length+u.unit:" + "+u.length+u.unit,l+=""==l?u.length+u.unit:" + "+u.length+u.unit}else("px"==u.unit||"%"==u.unit)&&(k+=""==k?u.length+u.unit:" + "+u.length+u.unit,"%"!=u.unit?l+=""==l?u.length+u.unit:" + "+u.length+u.unit:m+=u.length)}for(var x="0px",o=0;o<h.length;o++){var u=j[o];u.css.offset="calc("+x+")","*"==u.raw?(x+=" + (100% - ("+k+"))",u.css.length="calc(100% - ("+k+"))"):"px"==u.unit||"%"==u.unit?(x+=" + "+u.length+u.unit,u.css.length="calc("+u.length+u.unit+")"):"%*"==u.unit&&(x+=" + (100% - ("+k+")) * "+u.length+" / 100",u.css.length="calc((100% - ("+k+")) * "+u.length+" / 100)")}if(JSON.stringify(j)!=this._lastChildOptions||!e){i.pushSelector("."+this._className),i.property("position","relative"),i.property("min-"+this._lengthName,"calc(("+l+") / "+(100-m)+" * 100)"),i.property("overflow","hidden");for(var o=0;o<h.length;o++){var p=h.eq(o),u=j[o];p.addClass(this._className+"-"+o),i.pushSelector("."+this._className+">."+this._className+"-"+o),"?"!=u.raw&&i.property(this._lengthName,u.css.length),i.property(this._offsetName,u.css.offset),i.property(this._quadratureLengthName,100,"%"),i.property("position","absolute")}g(this._className,i.toString()),this._width=this._element.width(),this._height=this._element.height(),this._lastChildOptions=JSON.stringify(j);for(var o=0;o<h.length;o++){var p=h.eq(o);p.kLayouter("layout")}this._element.parent()&&e&&this._element.parent().kLayouter("layout",!0)}}},a}(),l={},m=new c.DynamicStylesheet("kLayouter-"+e());d.fn.extend({kLayouter:function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(0==arguments.length)for(var d=0;d<this.length;d++)j(this.eq(d));else switch(a){case"layout":for(var d=0;d<this.length;d++){var e=this[d]["kLayouter-item"];e&&("undefined"!=typeof b[0]?e.layout(b[0]):e.layout())}}}})});