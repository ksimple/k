define("kLayouter",["require","exports","kFundamental","jquery"],function(a,b,c,d){function e(){return window.performance&&window.performance.now?Math.floor(window.performance.now())+"-"+Math.floor(1e4*Math.random()):(new Date).valueOf()+"-"+Math.floor(1e4*Math.random())}function f(a){return a.match(/(\d*)(.*)/).slice(1)}function g(a,b){b?l[a]=b:delete l[a];var c="";for(var a in l)c+=l[a];m.content(c)}function h(){d(document.body).trigger("kLayouter.sizeChanged",{target:document.body})}function i(a){if(a){var b=new c.CssTextBuilder;b.pushSelector("html, body"),b.property("position","absolute"),b.property("width","100%"),b.property("height","100%"),b.property("border","0px"),b.property("margin",0,"px"),b.property("padding",0,"px"),g("body",b.toString()),d(window).on("resize",h)}else g("body"),d(window).off("resize",h)}function j(a){a=d(a).eq(0),a[0]==window&&(a=d(document.body));var b=a.find("[kLayouter-type]");a.attr("kLayouter-type")&&(b=d(a).add(b));for(var c=0;c<b.length;c++){var e=b.eq(c);if(!e[0]["kLayouter-item"])switch(e[0]["kLayouter-type"]){case"vertical":e[0]["kLayouter-item"]=new k(e,"vertical");break;case"horizontal":e[0]["kLayouter-item"]=new k(e,"horizontal")}}}var k=function(){function a(a,b){var c=this;this._direction=b,this._element=a,this._className="kLayouter-"+e(),this._element.addClass(this._className),"vertical"==this._direction?(this._offsetName="top",this._offsetName="top",this._lengthName="height",this._quadratureLengthName="width"):(this._offsetName="left",this._lengthName="width",this._quadratureLengthName="height"),"BODY"==this._element[0].tagName&&i(!0),this.layout(),this._element.on("kLayouter.sizeChanged",function(a){return c._sizeChanged(a)}),this._element.on("kLayouter.relayout",function(a){return c._relayout(a)})}return a.prototype.layout=function(){for(var a=this._element.find(">div"),b=new c.CssTextBuilder,d=[],e="",h=0;h<a.length;h++){var i=a.eq(h),j=i.attr("kLayouter-"+this._lengthName),k=f(j),l=k[0],m=k[1],n={raw:j,index:h,length:l,unit:m,css:{}};if(d.push(n),"?"==j){var o;"vertical"==this._direction?o=i[this._lengthName]():(i.css("display","inline-block"),o=i[this._lengthName](),i.css("display","")),n.length=o,n.unit="px",e+=""==e?n.length+n.unit:" + "+n.length+n.unit}else("px"==m||"%"==m)&&(e+=""==e?n.length+n.unit:" + "+n.length+n.unit)}for(var p="0px",h=0;h<a.length;h++){var n=d[h];n.css.offset="calc("+p+")","*"==n.raw?(p+=" + (100% - ("+e+"))",n.css.length="calc(100% - ("+e+"))"):"px"==n.unit||"%"==n.unit?(p+=" + "+n.length+n.unit,n.css.length="calc("+n.length+n.unit+")"):"%*"==n.unit&&(p+=" + (100% - ("+e+")) * "+n.length+" / 100",n.css.length="calc((100% - ("+e+")) * "+n.length+" / 100)")}b.pushSelector("."+this._className),b.property("position","relative");for(var h=0;h<a.length;h++){var i=a.eq(h),n=d[h];i.addClass(this._className+"-"+h),b.pushSelector("."+this._className+">."+this._className+"-"+h),"?"!=n.raw&&b.property(this._lengthName,n.css.length),b.property(this._offsetName,n.css.offset),b.property(this._quadratureLengthName,100,"%"),b.property("position","absolute")}g(this._className,b.toString()),i.css("overflow","hidden");for(var h=0;h<a.length;h++){var i=a.eq(h);i.trigger("kLayouter.sizeChanged",{target:i[0]})}},a.prototype._sizeChanged=function(a){a.target==this._element[0]&&this.layout()},a.prototype._relayout=function(a){a.target==this._element[0]&&this.layout()},a}(),l={},m=new c.DynamicStylesheet("kLayouter-"+e());b.attach=j});