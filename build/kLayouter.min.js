define("kLayouter",["require","exports","kFundamental","jquery"],function(a,b,c,d){function e(){return window.performance&&window.performance.now?Math.floor(window.performance.now())+"-"+Math.floor(1e4*Math.random()):(new Date).valueOf()+"-"+Math.floor(1e4*Math.random())}function f(a){return a.match(/(\d*)(.*)/).slice(1)}function g(a,b){b?l[a]=b:delete l[a];var c="";for(var a in l)c+=l[a];m.content(c)}function h(){d(document.body).kLayouter("layout")}function i(a){if(a){var b=new c.CssTextBuilder;b.pushSelector("html, body"),b.property("position","absolute"),b.property("width","100%"),b.property("height","100%"),b.property("border","0px"),b.property("margin",0,"px"),b.property("padding",0,"px"),g("body",b.toString()),d(window).on("resize",h)}else g("body"),d(window).off("resize",h)}function j(a){a=d(a).eq(0),a[0]==window&&(a=d(document.body));var b=a.find("[kLayouter-type]");a.attr("kLayouter-type")&&(b=d(a).add(b));for(var c=0;c<b.length;c++){var e=b.eq(c);if(!e[0]["kLayouter-item"])switch(e.attr("kLayouter-type")){case"vertical":e[0]["kLayouter-item"]=new k(e,"vertical");break;case"horizontal":e[0]["kLayouter-item"]=new k(e,"horizontal")}}}var k=function(){function a(a,b){var c=this;this._direction=b,this._element=a,this._className="kLayouter-"+e(),this._element.addClass(this._className),"vertical"==this._direction?(this._offsetName="top",this._offsetName="top",this._lengthName="height",this._quadratureLengthName="width"):(this._offsetName="left",this._lengthName="width",this._quadratureLengthName="height"),"BODY"==this._element[0].tagName&&i(!0),this.layout(),this._element.on("kLayouter.sizeChanged",function(a){return c._sizeChanged(a)}),this._element.on("kLayouter.relayout",function(a){return c._relayout(a)})}return a.prototype.layout=function(){var a=this._element.width(),b=this._element.height();if(this._width!=a||this._height!=b){for(var d=this._element.find(">div"),e=new c.CssTextBuilder,h=[],i="",j="",k=0,l=!1,m=0;m<d.length;m++){var n=d.eq(m),o=n.attr("kLayouter-"+this._lengthName),p=f(o),q=p[0],r=p[1],s={raw:o,index:m,length:q,unit:r,css:{}};if(h.push(s),"?"==o){if(!l){var t=new c.CssTextBuilder;t.pushSelector("."+this._className),t.property("position","relative"),t.pushSelector("."+this._className+">*"),t.property("position","absolute"),g(this._className,t.toString()),l=!0}var u;n.css("position","relative"),"vertical"==this._direction?u=n[this._lengthName]():(n.css("display","inline-block"),u=n[this._lengthName](),n.css("display","")),n.css("position",""),s.length=u,s.unit="px",i+=""==i?s.length+s.unit:" + "+s.length+s.unit,j+=""==j?s.length+s.unit:" + "+s.length+s.unit}else("px"==s.unit||"%"==s.unit)&&(i+=""==i?s.length+s.unit:" + "+s.length+s.unit,"%"!=s.unit?j+=""==j?s.length+s.unit:" + "+s.length+s.unit:k+=s.length)}for(var v="0px",m=0;m<d.length;m++){var s=h[m];s.css.offset="calc("+v+")","*"==s.raw?(v+=" + (100% - ("+i+"))",s.css.length="calc(100% - ("+i+"))"):"px"==s.unit||"%"==s.unit?(v+=" + "+s.length+s.unit,s.css.length="calc("+s.length+s.unit+")"):"%*"==s.unit&&(v+=" + (100% - ("+i+")) * "+s.length+" / 100",s.css.length="calc((100% - ("+i+")) * "+s.length+" / 100)")}e.pushSelector("."+this._className),e.property("position","relative"),e.property("min-"+this._lengthName,"calc(("+j+") / "+(100-k)+" * 100)"),e.property("overflow","hidden");for(var m=0;m<d.length;m++){var n=d.eq(m),s=h[m];n.addClass(this._className+"-"+m),e.pushSelector("."+this._className+">."+this._className+"-"+m),"?"!=s.raw&&e.property(this._lengthName,s.css.length),e.property(this._offsetName,s.css.offset),e.property(this._quadratureLengthName,100,"%"),e.property("position","absolute")}g(this._className,e.toString()),this._width=this._element.width(),this._height=this._element.height();for(var m=0;m<d.length;m++){var n=d.eq(m);n.kLayouter("layout")}this._element.parent()&&this._element.parent().kLayouter("layout")}},a.prototype._sizeChanged=function(a){a.target==this._element[0]&&this.layout()},a.prototype._relayout=function(a){a.target==this._element[0]&&this.layout()},a}(),l={},m=new c.DynamicStylesheet("kLayouter-"+e());d.fn.extend({kLayouter:function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(0==arguments.length)for(var d=0;d<this.length;d++)j(this.eq(d));else switch(a){case"layout":for(var d=0;d<this.length;d++){var e=this[d]["kLayouter-item"];e&&e.layout()}}}})});