define("kLayouter",["require","exports","kFundamental","jquery"],function(a,b,c,d){function e(){return window.performance&&window.performance.now?Math.floor(window.performance.now())+"-"+Math.floor(1e4*Math.random()):(new Date).valueOf()+"-"+Math.floor(1e4*Math.random())}function f(a){return a.match(/(\d*)(.*)/).slice(1)}function g(a,b){b?l[a]=b:delete l[a];var c="";for(var a in l)c+=l[a];m.content(c)}function h(){d(document.body).trigger("kLayouter.sizeChanged",{target:document.body})}function i(a){if(a){var b=new c.CssTextBuilder;b.pushSelector("html, body"),b.property("position","absolute"),b.property("width","100%"),b.property("height","100%"),b.property("border","0px"),b.property("margin",0,"px"),b.property("padding",0,"px"),g("body",b.toString()),d(window).on("resize",h)}else g("body"),d(window).off("resize",h)}function j(a){a=d(a).eq(0),a[0]==window&&(a=d(document.body));var b=a.find("[kLayouter-type]");a.attr("kLayouter-type")&&(b=d(a).add(b));for(var c=0;c<b.length;c++){var e=b.eq(c);if(!e[0]["kLayouter-item"])switch(e.attr("kLayouter-type")){case"vertical":e[0]["kLayouter-item"]=new k(e,"vertical");break;case"horizontal":e[0]["kLayouter-item"]=new k(e,"horizontal")}}}var k=function(){function a(a,b){var c=this;this._direction=b,this._element=a,this._className="kLayouter-"+e(),this._element.addClass(this._className),"vertical"==this._direction?(this._offsetName="top",this._offsetName="top",this._lengthName="height",this._quadratureLengthName="width"):(this._offsetName="left",this._lengthName="width",this._quadratureLengthName="height"),"BODY"==this._element[0].tagName&&i(!0),this.layout(),this._element.on("kLayouter.sizeChanged",function(a){return c._sizeChanged(a)}),this._element.on("kLayouter.relayout",function(a){return c._relayout(a)})}return a.prototype.layout=function(){for(var a=this._element.find(">div"),b=new c.CssTextBuilder,d=[],e="",h=!1,i=0;i<a.length;i++){var j=a.eq(i),k=j.attr("kLayouter-"+this._lengthName),l=f(k),m=l[0],n=l[1],o={raw:k,index:i,length:m,unit:n,css:{}};if(d.push(o),"?"==k){if(!h){var p=new c.CssTextBuilder;p.pushSelector("."+this._className),p.property("position","relative"),p.pushSelector("."+this._className+">*"),p.property("position","absolute"),g(this._className,p.toString()),h=!0}var q;j.css("position","relative"),"vertical"==this._direction?q=j[this._lengthName]():(j.css("display","inline-block"),q=j[this._lengthName](),j.css("display","")),j.css("position",""),o.length=q,o.unit="px",e+=""==e?o.length+o.unit:" + "+o.length+o.unit}else("px"==n||"%"==n)&&(e+=""==e?o.length+o.unit:" + "+o.length+o.unit)}e="max(0px, "+e+")";for(var r="0px",i=0;i<a.length;i++){var o=d[i];o.css.offset="calc("+r+")","*"==o.raw?(r+=" + (100% - ("+e+"))",o.css.length="calc(100% - ("+e+"))"):"px"==o.unit||"%"==o.unit?(r+=" + "+o.length+o.unit,o.css.length="calc("+o.length+o.unit+")"):"%*"==o.unit&&(r+=" + (100% - ("+e+")) * "+o.length+" / 100",o.css.length="calc((100% - ("+e+")) * "+o.length+" / 100)")}b.pushSelector("."+this._className),b.property("position","relative");for(var i=0;i<a.length;i++){var j=a.eq(i),o=d[i];j.addClass(this._className+"-"+i),b.pushSelector("."+this._className+">."+this._className+"-"+i),"?"!=o.raw&&b.property(this._lengthName,o.css.length),b.property(this._offsetName,o.css.offset),b.property(this._quadratureLengthName,100,"%"),b.property("position","absolute")}g(this._className,b.toString()),j.css("overflow","hidden");for(var i=0;i<a.length;i++){var j=a.eq(i);j.trigger("kLayouter.sizeChanged",{target:j[0]})}},a.prototype._sizeChanged=function(a){a.target==this._element[0]&&this.layout()},a.prototype._relayout=function(a){a.target==this._element[0]&&this.layout()},a}(),l={},m=new c.DynamicStylesheet("kLayouter-"+e());b.attach=j});