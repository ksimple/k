define("kLayouter",["require","exports","kFundamental","jquery"],function(a,b,c,d){function e(){return Math.floor(window.performance.now())+"-"+Math.floor(1e4*Math.random())}function f(a){return a.match(/(\d*)(.*)/).slice(1)}function g(a,b){b?m[a]=b:delete m[a];var c="";for(var a in m)c+=m[a];n.content(c)}function h(){d(document.body).trigger("kLayouter.sizeChanged")}function i(a){if(a){var b=new c.CssTextBuilder;b.pushSelector("html, body"),b.property("position","absolute"),b.property("width","100%"),b.property("height","100%"),b.property("border","0px"),b.property("margin",0,"px"),b.property("padding",0,"px"),g("body",b.toString()),d(window).on("resize",h)}else g("body"),d(window).off("resize",h)}function j(a){a=d(a).eq(0),a[0]==window&&(a=d(document.body));var b=a.find("[kLayouter-type]");a.attr("kLayouter-type")&&(b=d(a).add(b));for(var c=0;c<b.length;c++){var e=b.eq(c);if(!e.data("kl-item"))switch(e.attr("kLayouter-type")){case"vertical":e.data("kl-item",new k(e));break;case"horizontal":e.data("kl-item",new l(e))}}}var k=function(){function a(a){var b=this;this._element=a,this._className="kLayouter-"+e(),this._element.addClass(this._className),"BODY"==this._element[0].tagName&&i(!0),this.layout(),this._element.on("kLayouter.sizeChanged",function(){return b._sizeChanged()}),this._element.on("kLayouter.relayout",function(){return b.layout()})}return a.prototype.layout=function(){for(var a=this._element.find(">div"),b=new c.CssTextBuilder,d=[],e="",h=0;h<a.length;h++){var i=a.eq(h),j=i.attr("kLayouter-height"),k=f(j),l=k[0],m=k[1],n={raw:j,index:h,height:l,unit:m,css:{}};if(d.push(n),"?"==j){var o=i.height();n.height=o,n.unit="px",e+=""==e?n.height+n.unit:" + "+n.height+n.unit}else("px"==m||"%"==m)&&(e+=""==e?n.height+n.unit:" + "+n.height+n.unit)}for(var p="0px",h=0;h<a.length;h++){var n=d[h];n.css.top="calc("+p+")","*"==n.raw?(p+=" + (100% - ("+e+"))",n.css.height="calc(100% - ("+e+"))"):"px"==n.unit||"%"==n.unit?(p+=" + "+n.height+n.unit,n.css.height="calc("+n.height+n.unit+")"):"%*"==n.unit&&(p+=" + (100% - ("+e+")) * "+n.height+" / 100",n.css.height="calc((100% - ("+e+")) * "+n.height+" / 100)")}b.pushSelector("."+this._className),b.property("position","relative");for(var h=0;h<a.length;h++){var i=a.eq(h),n=d[h];i.addClass(this._className+"-"+h),b.pushSelector("."+this._className+">."+this._className+"-"+h),"?"!=n.raw&&b.property("height",n.css.height),b.property("top",n.css.top),b.property("width",100,"%"),b.property("position","absolute")}g(this._className,b.toString())},a.prototype._sizeChanged=function(){this.layout()},a}(),l=function(){function a(a){this._element=a}return a}(),m={},n=new c.DynamicStylesheet("kLayouter-"+e());b.attach=j});