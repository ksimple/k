define("kUI",["require","exports","kFundamental","jquery","jquery.migrate"],function(a,b,c,d){function e(){return window.performance&&window.performance.now?Math.floor(window.performance.now())+"-"+Math.floor(1e4*Math.random()):(new Date).valueOf()+"-"+Math.floor(1e4*Math.random())}function f(a){var b=a.match(/(\d*)(.*)/).slice(1),c=b[0],d=b[1];return c=parseInt(c),[c,d]}function g(a,b){b?m[a]=b:delete m[a];var c="";for(var a in m)c+=m[a];n.content(c)}function h(){d(document.body).k("layout")}function i(a){if(a){var b=new c.CssTextBuilder;b.pushSelector("html, body"),b.property("position","absolute"),b.property("width","100%"),b.property("height","100%"),b.property("border","0px"),b.property("margin",0,"px"),b.property("padding",0,"px"),g("body",b.toString()),d(window).on("resize",h)}else g("body"),d(window).off("resize",h)}function j(a){a=d(a).eq(0),(a[0]==window||a[0]==document)&&(a=d(document.body));var b=a.find("[k-type]");a.attr("k-type")&&(b=d(a).add(b));for(var c=0;c<b.length;c++){var e=b.eq(c);if(!e[0]["k-item"])switch(e.attr("k-type")){case"stack":e[0]["k-item"]=new k(e,e.attr("k-options"));break;case"layer":e[0]["k-item"]=new l(e,e.attr("k-options"))}}}var k=function(){function a(a,b){this._direction=b,this._element=a,this._classSelectorName="k-ui-stack-"+e(),this._className="k-ui k-ui-stack "+this._classSelectorName,this._element.addClass(this._className),"vertical"==this._direction?(this._offsetName="top",this._offsetName="top",this._lengthName="height",this._quadratureLengthName="width"):(this._offsetName="left",this._lengthName="width",this._quadratureLengthName="height"),"BODY"==this._element[0].tagName&&i(!0),this.layout()}return a.prototype.layout=function(){var a=this._element.width(),b=this._element.height(),c=(this._width!=a||this._height!=b,!1);if(c=d.browser.msie&&d.browser.version<9?this._layoutByJavascript():this._layoutByCssCalc())for(var e=this._element.find(">div"),f=0;f<e.length;f++){var g=e.eq(f);g.k("layout")}return!0},a.prototype._layoutByCssCalc=function(){var a=this._element.width(),b=this._element.height(),e=this._width!=a||this._height!=b;if(!e)return!1;for(var h=this._element.find(">div"),i=new c.CssTextBuilder,j=[],k="",l="",m=0,n=!1,o=0;o<h.length;o++){var p=h.eq(o),q=p.attr("k-ui-stack-"+this._lengthName),r=f(q),s=r[0],t=r[1],u={raw:q,index:o,length:s,unit:t,css:{}};if(j.push(u),"?"==q){if(!n){var v=new c.CssTextBuilder;v.pushSelector("."+this._classSelectorName),v.property("position","relative"),v.pushSelector("."+this._classSelectorName+">*"),v.property("position","absolute"),g(this._classSelectorName,v.toString()),n=!0}var w;p.css("position","relative"),"vertical"==this._direction?w=p[this._lengthName]():(p.css("display","inline-block"),w=p[this._lengthName](),p.css("display","")),p.css("position",""),u.length=w,u.unit="px",k+=""==k?u.length+u.unit:" + "+u.length+u.unit,l+=""==l?u.length+u.unit:" + "+u.length+u.unit}else("px"==u.unit||"%"==u.unit)&&(k+=""==k?u.length+u.unit:" + "+u.length+u.unit,"%"!=u.unit?l+=""==l?u.length+u.unit:" + "+u.length+u.unit:m+=u.length)}for(var x="0px",o=0;o<h.length;o++){var u=j[o];u.css.offset="calc("+x+")","*"==u.raw?(x+=" + (100% - ("+k+"))",u.css.length="calc(100% - ("+k+"))"):"px"==u.unit||"%"==u.unit?(x+=" + "+u.length+u.unit,u.css.length="calc("+u.length+u.unit+")"):"%*"==u.unit&&(x+=" + (100% - ("+k+")) * "+u.length+" / 100",u.css.length="calc((100% - ("+k+")) * "+u.length+" / 100)")}if(JSON.stringify(j)==this._lastChildrenOptions&&e)return!1;i.pushSelector("."+this._classSelectorName),i.property("position","relative"),i.property("min-"+this._lengthName,"calc(("+l+") / "+(100-m)+" * 100)"),d.browser.msie&&i.property("overflow","hidden");for(var o=0;o<h.length;o++){var p=h.eq(o),u=j[o];p.addClass(this._className+"-"+o),i.pushSelector("."+this._classSelectorName+">."+this._classSelectorName+"-"+o),"?"!=u.raw&&i.property(this._lengthName,u.css.length),i.property(this._offsetName,u.css.offset),i.property(this._quadratureLengthName,100,"%"),i.property("position","absolute")}return g(this._classSelectorName,i.toString()),this._width=this._element.width(),this._height=this._element.height(),this._lastChildrenOptions=JSON.stringify(j),!0},a.prototype._layoutByJavascript=function(){var a=this._element.width(),b=this._element.height(),d=this._width!=a||this._height!=b;if(!d)return!1;for(var e=this._element.find(">div"),h=null,i=[],j=!1,k=0;k<e.length;k++){var l=e.eq(k),m=l.attr("k-ui-stack-"+this._lengthName),n=f(m),o=n[0],p=n[1],q={raw:m,index:k,length:o,unit:p};if(i.push(q),"?"!=m&&"*"!=m&&"px"!=p&&"%*"!=p&&"%"!=p)throw c.createError(0,"k.ui.Stack","Unsupported unit "+q.raw);if("?"==m){j||(h=new c.CssTextBuilder,h.pushSelector("."+this._classSelectorName),h.property("position","relative"),h.pushSelector("."+this._classSelectorName+">*"),h.property("position","absolute"),g(this._classSelectorName,h.toString()),j=!0);var r;l.css("position","relative"),"vertical"==this._direction?r=l[this._lengthName]():(l.css("display","inline-block"),r=l[this._lengthName](),l.css("display","")),l.css("position",""),q.length=r,q.unit="px"}}if(JSON.stringify(i)==this._lastChildrenOptions&&!d)return!1;h=new c.CssTextBuilder,h.pushSelector("."+this._classSelectorName),h.property("position","relative"),h.property("overflow","hidden");for(var k=0;k<e.length;k++){var l=e.eq(k),q=i[k];l.addClass(this._classSelectorName+"-"+k),("px"==q.unit||"%"==q.unit)&&(h.pushSelector("."+this._classSelectorName+">."+this._classSelectorName+"-"+k),"?"!=q.raw&&h.property(this._lengthName,q.length,q.unit),h.property(this._quadratureLengthName,100,"%"),h.property("position","absolute"))}g(this._classSelectorName,h.toString());for(var s=0,t=this._element[this._lengthName](),k=0;k<e.length;k++){var l=e.eq(k),q=i[k];("?"==q.raw||"px"==q.unit||"%"==q.unit)&&("px"!=q.unit&&(q.length=l[this._lengthName](),q.unit="px"),s+=q.length)}var u=0;s>t&&(s=t);for(var k=0;k<e.length;k++){var q=i[k];"*"==q.raw?(q.length=t-s,q.unit="px"):"%*"==q.unit&&(q.length=(t-s)*q.length/100,q.unit="px"),q.offset=u,u+=q.length}h=new c.CssTextBuilder,h.pushSelector("."+this._classSelectorName),h.property("position","relative"),h.property("overflow","hidden");for(var k=0;k<e.length;k++){var q=i[k];h.pushSelector("."+this._classSelectorName+">."+this._classSelectorName+"-"+k),"?"!=q.raw&&h.property(this._lengthName,q.length,q.unit),h.property(this._offsetName,q.offset,q.unit),h.property(this._quadratureLengthName,100,"%"),h.property("position","absolute")}return g(this._classSelectorName,h.toString()),this._width=this._element.width(),this._height=this._element.height(),this._lastChildrenOptions=JSON.stringify(i),!0},a}(),l=function(){function a(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];this._element=a,this._classSelectorName="k-ui-layout-"+e(),this._className="k-ui k-ui-layout "+this._classSelectorName,this._element.addClass(this._className),"BODY"==this._element[0].tagName&&i(!0),this._initialize()}return a.prototype.layout=function(){var a=this._element.width(),b=this._element.height(),c=this._width!=a||this._height!=b;if(!c)return!1;this._internalLayout();for(var d=this._element.find(">div"),e=0;e<d.length;e++){var f=d.eq(e);f.k("layout")}return!0},a.prototype.add=function(a,b){void 0===b&&(b=-1);var c={name:a,element:d('<div class="k-full"></div>')};0>b&&(b=this._layers.length+b+1);var e=this._layers[b].element;return this._layers.splice(b,0,[c]),e.after(c.element),c.element},a.prototype.get=function(a){var b=[];if("number"==typeof a)this._layers[a]&&b.push(this._layers[a].element[0]);else if("string"==typeof a||"function"==typeof a||"undefined"==typeof a)for(var c=0;c<this._layers.length;c++)this._checkIfMeetSelector(a,c)&&b.push(this._layers[c].element[0]);return d(b)},a.prototype.remove=function(a){var b=[];if("number"==typeof a){if(this._layers[a]){var c=this._layers[a];this._layers.splice(a,1),c.element.remove()}}else if("string"==typeof a||"function"==typeof a||"undefined"==typeof a){for(var d=0;d<this._layers.length;d++)this._checkIfMeetSelector(a,d)&&b.push({index:d,element:this._layers[d].element[0]});for(var d=b.length-1;d>=0;d--)this._layers.splice(b[d].index,1),b[d].element.remove()}},a.prototype._initialize=function(){this._layers=[];for(var a=this._element.find(">div"),b=0;b<a.length;b++){var c=a.eq(b),d=c.attr("k-ui-layer-name");if(d){c.addClass("k-full");var e={name:d,element:c};this._layers.push(e)}}},a.prototype._internalLayout=function(){this._element.addClass("k-relative")},a.prototype._checkIfMeetSelector=function(a,b){var c=this._layers[b];return"number"==typeof a?a==b:"string"==typeof a?c.name==a:"function"==typeof a?a({name:c.name,element:c.element}):"undefined"==typeof a?!0:new Error("Unsupported selector")},a}(),m={"k-relative":"{ position: relative; }","k-full":"{ position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px }"},n=new c.DynamicStylesheet("k-"+e());!function(){var a="";for(var b in m)a+=m[b];n.content(a)}(),d.fn.extend({k:function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(0==arguments.length)for(var d=0;d<this.length;d++)j(this.eq(d));else for(var d=0;d<this.length;d++){if(this.eq(d).attr("k-type")){var e=this[d]["k-item"];if(!e)continue;if("function"==typeof e[a])return e[a].apply(e,b);console.warn("method "+a+" doesn't exist on the kItem with type "+this.eq(d).attr("k-type"))}break}}})});